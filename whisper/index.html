
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Aprendizaje progresivo para conocer las posibilidades de la IA.">
      
      
        <meta name="author" content="IES Severo Ochoa">
      
      
        <link rel="canonical" href="https://sever8a.github.io/neuronal/whisper/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.0b4">
    
    
      
        <title>Whisper - Deep Learning</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.91872f81.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-Y671WB1DQM"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-Y671WB1DQM",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-Y671WB1DQM",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#primeros-pasos-con-whisper" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Deep Learning" class="md-header__button md-logo" aria-label="Deep Learning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Deep Learning
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Whisper
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Deep Learning" class="md-nav__button md-logo" aria-label="Deep Learning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Deep Learning
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Comenzando
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../proceso/" class="md-nav__link">
        El proceso
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../deep_learning/" class="md-nav__link">
        Machine vs Deep
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Pasos b치sicos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pasos b치sicos" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Pasos b치sicos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../exploradatos/" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../exploradatos/" class="md-nav__link">
        An치lisis Exploratorio
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../machinelearning/" class="md-nav__link">
        Machine Learning
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Redes Neuronales
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Redes Neuronales" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Redes Neuronales
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redesneuronales/" class="md-nav__link">
        Redes Neuronales
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redesneuronales/fundamentos/" class="md-nav__link">
        Fundamentos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redesneuronales/redes_profundas/" class="md-nav__link">
        Redes Densas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redesneuronales/temporales/" class="md-nav__link">
        Redes Recurrentes/LSTM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redesneuronales/convolucionales/" class="md-nav__link">
        Redes Convolucionales
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redesneuronales/hiperparametros/" class="md-nav__link">
        Hiperpar치metros
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redesneuronales/gan/" class="md-nav__link">
        Redes Generativas Adversarias
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../transferencia/" class="md-nav__link">
        Transferencia de conocimiento
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Procesamento Lenguaje Natural
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Procesamento Lenguaje Natural" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Procesamento Lenguaje Natural
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nlp/" class="md-nav__link">
        Conceptos b치sicos
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Whisper
      </a>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../no_supervisado/" class="md-nav__link">
        Aprendizaje no supervisado
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../redesneuronales/tareas1/" class="md-nav__link">
        Tareas
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="primeros-pasos-con-whisper">Primeros pasos con Whisper</h1>
<p>Este modelo gratuito y abierto, est치 disponible para su uso y adaptaci칩n a cualquier circunstancia.</p>
<p>Desarrollado por OpenAI. Entrenado con miles de horas basadas en lecturas de la Wikipedia. Ofrece la posibilidad de multilenguaje.</p>
<p>Se basa en la arquitectura <strong><em>transformer</em></strong>, que est치 consiguiendo resultado impresionanentes para problemas de secuenciaci칩n. Y en particular para Procesamiento de Lenguaje Natural.</p>
<p><img alt="Estructura del modelo Whisper" src="https://huggingface.co/blog/assets/111_fine_tune_whisper/whisper_architecture.svg" /></p>
<p>El modelo tiene varias versiones que ofrecen diferente rendimiento, a la vez que se ajustan a la potencia de c치lculo de diferentes plataformas.</p>
<ul>
<li>tiny</li>
<li>base</li>
<li>small</li>
<li>medium</li>
<li>large</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Prueba en la line</p>
<p>Es posible probar las prestaciones del modelo original desde la <a href="https://huggingface.co/spaces/openai/whisper">p치gina web de <strong>Hugging Face</strong>, dentro del apartado <strong>Spaces</strong>.</a></p>
</div>
<h1 id="pruebas-de-concepto">Pruebas de concepto</h1>
<p>El objetivo de este modelo es transcribir los sonidos a texto. Consigue unos resultados muy buenos, porque detecta la entonaci칩n y las pausas, estableciendo los signos de puntaci칩n adecuados.</p>
<p>Para interpretaciones de locuciones largas, se consigue una precisi칩n muy correcta.</p>
<p>Con la versi칩n <strong>small</strong> ya se consiguen unos resultados muy fiables del sonido, incluso con sonidos de baja calidad o ruido. Sin embargo, el tiempo que requiere para obtener el resultado es demasiado alto (60 segundos de promedio por sentecia).</p>
<p>Utilizando los modelos inferiores (<strong>tiny</strong> y <strong>base</strong>) los resultados son muy similares en precisi칩n, lo que no justifica el doble de tiempo que requiere la versi칩n <strong>base</strong> sobre la versi칩n <strong>tiny</strong>.</p>
<div class="admonition info">
<p class="admonition-title">Atenci칩n</p>
<p>Los resultados similares, no significa que se mantenga la precisi칩n de los modelos superiores. En estos dos m치s b치sicos, son frecuentes los errores y trascripciones de palabras incorrectas u omisiones.</p>
</div>
<p>No sirve de nada esperar 15 segundos para obtener un resultado que no es correcto. En este sentido resulta adecuado elegir la versi칩n <strong>small</strong>.</p>
<p>Hay que tener en cuenta el volumen del modelo y todo el procesamiento que supone. Disponer de procesamiento paralelo facilitar치 obtener un resultado m치s r치pidamente.</p>
<p>Se puede especifar algunos par치metros adicionales al realizar al transcripci칩n para agilizar el pre-procesado de los datos. Una de estas opciones es especificar el lenguaje.</p>
<p>La misma funcionalidad se puede conseguir con un cuaderno Google Colab, donde el procesamiento ser치 m치s r치pido, aunque es necesario enviar el fichero de audio.</p>
<p><a href="https://colab.research.google.com/drive/1jnspg2FyeEm9v08_aNqmhPv0bfN2r1PN?usp=sharing">Ejemplo en Google Colab, para uso directo.</a></p>
<p>En este ejemplo se instalan las librer칤as de Whisper desde el repositorio de github. </p>
<p>Se establecen las rutas a las carpetas en Google Colab. Cuesti칩n importante en este entorno, ya que la existencia de los ficheros se limita al tiempo de ejecuci칩n del kernel.</p>
<p>Crea un entorno gr치fico sencillo, integrado en el notebook, para interactuar con el usuario eligiendo las opciones de transcripci칩n.</p>
<p>El fichero a transcribir debe ser subido a la plataforma.</p>
<p>Genera un fichero de texto con la transcripci칩n, por si se quiere descargar para su posterior procesamiento.</p>
<h1 id="fine-tuning-ajustando-el-modelo">Fine tuning. Ajustando el modelo</h1>
<p>El principal objetivo es ajustar el modelo existen a las necesidades particulares de nuestro problema.</p>
<p>Aprovechamos el modelo pre-entrenado para realizar el fine tuning.</p>
<ol>
<li>Carga del dataset. Puede ser muy pesado!.</li>
<li>Preparar los datos. Se divide en tres fases: extraer las caracteristicas relevantes del dataset. Tokenizar. Estas dos fases las realiza <strong><em>whisper processor</em></strong>. Finalmente hay que ajustar los datos al formato adecuado de entrada para el entrenamiento del modelo 16kHz.</li>
<li>Combinar los elementos del punto dos con <strong>whisper processor</strong>.</li>
<li>Entrenar y  evaluar el modelo.</li>
<li>M칠tricas de evaluaci칩n.</li>
<li>Inicializar el data collator.</li>
<li>Cargar el pre-entrenamiento.</li>
</ol>
<p>! info "Mi primera vez"</p>
<pre><code>Utilizo el c칩digo de ejemplo y gu칤a que ofrece Hugging Face para realizar el fine tuning. Inicialmente lo intento con google colab, pero atenci칩n, el ejemplo del dataset de muestra da error. No se descarga. Lo intento en local y lo mismo. Resulta que el dataset ya no est치 disponible (al menos en las fechas que lo intent칠).
Cambio de dataset, y utilizo uno de mozilla con voces en varios idiomas, tambi칠n est치 disponible en Hugging face, lo que facilita el uso ya que est치 preprocesado para utilizar train y test. El problema es que es demasiado grande (**107GB !!**), Google colab solo permite este espacio en la versi칩n gratuita.
Ciertamente la instalaci칩n de las librer칤as y el dataset, resulta inviable trasvarios intentos, utilizando diferentes opciones para reducir su tama침o (simplemente la descarga son horas !!).
</code></pre>
<p>Prueba una <a href="https://colab.research.google.com/drive/184wLPXdEnAeJH4bh8XrAHZjo8dLwYbT2?usp=sharing">versi칩n de fine tuning desde colab</a></p>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Cookie consent</h4>
<p>Esta p치gina de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentaci칩n y averiguar si encuentras aquello que buscas o c칩mo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        <label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand"], "search": "../assets/javascripts/workers/search.3de43c86.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ce0331ff.min.js"></script>
      
    
    
  </body>
</html>